#!/bin/sh


#
#
#


cmd=`which guetzli`

if [[ $cmd == "" ]]
then
   >&2 echo "ðŸš«  Install guetzli: https://github.com/google/guetzli"
   exit 1
fi


if [[ $1 == "" ]]
then
   >&2 echo "ðŸš«  No path(s) specified"
   exit 1
fi

for arg in $@;
do

  if [ -f "$arg" ];
  then
    f=`basename $arg`
    dir=`dirname $arg`

    echo $arg â†’ $dir/guetzli-$f
    `$cmd $arg $dir/guetzli-$f`

  elif [ -d "$arg" ];
  then
    dir=`basename $1`

    format=*.jpg
    for i in $dir/$format;
    do

      outdir="`dirname $i`/guetzli"

#      echo "out $outdir"

      if [ ! -d "$outdir" ];
      then
#        echo "making $outdir"
        mkdir $outdir
      fi

      f=`basename $i`;
      echo $i â†’ $outdir/$f;
      `$cmd $i $outdir/$f`
    done
  else
    >&2 echo "ðŸš«  Invalid path \"$1\""
  fi

done
